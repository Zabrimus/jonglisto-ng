plugins {
    id 'java'
    id 'war'
    id 'eclipse-wtp'
    id "org.xtext.xtend" version '1.0.19'
}

apply plugin: 'war'

sourceCompatibility = "1.8"
targetCompatibility = "1.8"

apply from: "gradle/dependencies.gradle"

configurations.all {
   exclude group:"com.vaadin", module: "vaadin-client"
   exclude group:"com.vaadin", module: "vaadin-client-compiler"
}

dependencies {
    runtime libs.jcl_over_slf4j

    compileOnly "javax.servlet:javax.servlet-api:3.1.0"

    compile files('external-jar/logo.jar')

    compile libs.guava
    compile libs.slf4j
    compile libs.xtend

    compile project(':annotation')
    compile project(':common')
    compile project(':web')
    compile project(':svdrp')
    compile project(':database')

    runtime 'com.vaadin.external.atmosphere:atmosphere-runtime:2.4.11.vaadin2'
}

allprojects {
    apply plugin: 'java'
    apply plugin: 'org.xtext.xtend'
    apply plugin: 'eclipse-wtp'

    repositories {
        jcenter()
        mavenCentral()

        maven {
            url "http://maven.vaadin.com/vaadin-addons"
        }
    }

    sourceSets {
        main.xtendOutputDir = 'src/main/xtend-gen'
        main.java.srcDirs += ['src/main/xtend-gen', 'src/main/resources', 'src/main/java']
    }
}

project(':annotation') {
    dependencies {
        compile libs.xtend
        compile libs.slf4j
        compile libs.guava
    }
}

project(':common') {
    dependencies {
        compile libs.xtend
        compile libs.gson
        compile libs.guava
        compile libs.commons
        compile libs.slf4j

        compile project(':annotation')
    }
}

project(':svdrp') {
    dependencies {
        compile libs.xtend
        compile libs.guava
        compile libs.commons
        compile libs.slf4j

        compile project(':annotation')
        compile project(':common')
    }
}

project(':database') {
    dependencies {
        compile libs.xtend
        compile libs.guava
        compile libs.commons
        compile libs.slf4j
        compile libs.juli
        compile libs.tomjdbc
        compile libs.sql2o
        compile libs.mysqljdbc

        compile(libs.tomjdbc) {
           transitive = false
        }

        compile project(':annotation')
        compile project(':common')
    }
}

project(':web') {
    dependencies {
        compile project(':annotation')
        compile project(':common')
        compile project(':svdrp')
        compile project(':database')

        compile libs.vaadinServer
        compile libs.vaadinThemes
        compile libs.vaadinClient
        compile libs.shirocore
        compile libs.shiroweb
        compile libs.logback
        compile libs.sanitizer
        compile libs.guava
        compile libs.slf4j
        compile libs.xtend

        compile addons.vicons

        compile(addons.scaleimage) {
            transitive = false
        }

        compile(addons.messagebox) {
            transitive = false
        }

        compileOnly 'javax.servlet:javax.servlet-api:3.1.0'
        compileOnly "com.vaadin:vaadin-client:8.1.7"
        compileOnly "com.vaadin:vaadin-client-compiler:8.1.7"
    }
}

task createLogoJar(type: Exec) {
  executable "sh"
  args "-c", "cd tools; ./build-logo-jar.sh"
}

task wrapper(type: Wrapper) {
  gradleVersion = '4.2.1'
}
